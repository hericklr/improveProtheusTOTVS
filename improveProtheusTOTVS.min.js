/* improveProtheusTOTVS v1.3.0 | https://github.com/hericklr/improveProtheusTOTVS */
(()=>{"use strict";const t=(t="")=>document.getElementById("mybcontainer_iframe").contentDocument.getElementById("principal").contentDocument.querySelector(t.trim()),e=(t="")=>document.getElementById("mybcontainer_iframe").contentDocument.getElementById("principal").contentDocument.querySelectorAll(t.trim()),r=(t="")=>""===t?"1970-01-01":(t.indexOf("/")>-1&&(2===(t=t.split("/").reverse())[0].length&&(t[0]=`20${t[0]}`),t=t.join("-")),t),a=(t="")=>""===t||4!==(t=t.replace(/\D+/g,"")).length?"00:00:00":t.replace(/(\d{2})(\d{2})$/,"$1:$2:00"),n=t=>new Date(`1970-01-01T${t}+0000`),o=t=>{t=Math.abs(t);let e=Math.floor(t/1e3),r=Math.floor(e/60),a=Math.floor(r/60);return r%=60,a=a.toString().padStart(2,"0"),r=r.toString().padStart(2,"0"),`${a}:${r}`},i=()=>{const t=l-4;let r,a=0;for(let n of e(`table > tbody > tr > td:nth-of-type(${t})`))n.parentElement.rowIndex<2||(r="0",c[a].totalTime>0&&(5===c[a].dayOfWeek&&c[a].totalTime<m.saturday||5!==c[a].dayOfWeek&&c[a].totalTime<m.weekday)&&(r="1"),n.setAttribute("data-out-of-bounds",r),++a)},d=()=>{const t=l-3;let r,a,n=0;for(let i of e(`table > tbody > tr > td:nth-of-type(${t})`))i.parentElement.rowIndex<2||(0!==c[n].totalTime?(r=c[n].totalTime-(5===c[n].dayOfWeek?m.saturday:m.weekday),a=r<0?"-":"+",i.setAttribute("data-sign",a),a=0===r?"":a+" ",i.innerHTML=a+o(r),++n):(i.setAttribute("data-sign","0"),++n))},s=t("table > tbody > tr:nth-of-type(1) > th:nth-of-type(1)");let l=parseInt(s.getAttribute("colspan"),10),c=[],m={weekday:new Date("1970-01-01T05:20:00+0000"),saturday:new Date("1970-01-01T03:00:00+0000")};t("body").hasAttribute("improved")||(t("head").appendChild(document.createElement("style")).innerHTML='#limitesAtuais{display:block;float:left;line-height:1.8rem}#limitesAtuais > b{color:inherit;font:inherit;font-weight:bold}table tbody tr:hover{background-color:#f3f3f3}table tbody tr:nth-child(2n+1):hover{background-color:#ededed}table tbody tr td[data-out-of-bounds="1"]{color:#f00}table tbody tr td[data-sign="-"]{background-color:rgba(255,0,0,.2)}table tbody tr td[data-sign="0"]{background-color:rgba(0,0,0,.12)}table tbody tr td[data-sign="+"]{background-color:rgba(0,255,0,.2)}',(()=>{const t=(l-5)/2;let o,i;for(let d of e("table > tbody > tr"))if(!(d.rowIndex<2)){i=0;for(let e=0;e<t;++e)""!==d.children[2*e+2].textContent.trim()&&""!==d.children[2*e+3].textContent.trim()&&(i+=n(a(d.children[2*e+3].textContent))-n(a(d.children[2*e+2].textContent)));0===i?o=-1:(o=new Date(r(d.children[0].textContent)+"T00:00:00+0000").getDay(),i=new Date(i)),c.push({dayOfWeek:o,totalTime:i})}})(),(()=>{const e=(t="",e="")=>{if(""===(t=t.trim()))return{error:!0,message:"Campo em análise não fornecido"};if(""===(e=e.replace(/[^\d\:]+/g,"")).trim())return{error:!0,message:`É necessário fornecer o limite de horas para os ${t}`};switch(e.length>5&&(e=e.substring(0,4)),(e=e.split(":")).length){case 1:e.push("0");break;case 2:break;default:return{error:!0,message:`Limite de horas para ${t} fornecido está em formato incorreto`}}return NaN===(e=e.map((t=>parseInt(t,10))))[0]||e[0]>11?{error:!0,message:`Horas fornecidas para o limite de horas para os ${t} precisa ser de 0 a 11`}:NaN===e[1]||e[1]>59?{error:!0,message:`Minutos fornecidos para o limite de horas para os ${t} precisa ser de 0 a 59`}:{error:!1,date:`1970-01-01T${e=e.map((t=>t.toString().padStart(2,"0"))).join(":")}:00+0000`}},r=()=>{t("#limitesAtuais").innerHTML=`Dias de semana: <b>${m.weekday.toISOString().substring(11,16)}</b> - Sábados: <b>${m.saturday.toISOString().substring(11,16)}</b>`};t("#filterMarks").insertAdjacentHTML("beforeend",'<input name="btnAjustaLimites" id="btnAjustaLimites" type="button" value="Ajusta Limites"><div id="limitesAtuais"></div>'),r(),t("#btnAjustaLimites").addEventListener("click",(()=>{let t,a,n;t=prompt("Limite de horas para dias de semana (HH:MM)\nMáximo de 11:59",m.weekday.toISOString().substring(11,16)),null!==t&&(a=prompt("Limite de horas para sábados (HH:MM)\nMáximo de 11:59",m.saturday.toISOString().substring(11,16)),null!==a&&(n=e("dias de semana",t),n.error?alert(n.message):(t=n.date,n=e("sábados",a),n.error?alert(n.message):(a=n.date,m={weekday:new Date(t),saturday:new Date(a)},r(),i(),d()))))}))})(),(()=>{s.setAttribute("colspan",l+2);for(let t of e("table > tbody > tr"))switch(t.rowIndex){case 0:continue;case 1:t.children[l-4].insertAdjacentHTML("afterend",'<th width="30">Total</th><th width="30">Diferença</th>');continue;default:t.children[l-4].insertAdjacentHTML("afterend",'<td class="info-cent">&nbsp;</td><td class="info-cent">&nbsp;</td>')}l+=2})(),(()=>{const t=l-4;let r=0;for(let a of e(`table > tbody > tr > td:nth-of-type(${t})`))a.parentElement.rowIndex<2||(0!==c[r].totalTime?(a.innerHTML=o(c[r].totalTime),++r):++r)})(),i(),d(),t("body").setAttribute("improved","yep"))})();