/* improveProtheusTOTVS v1.2.0 | https://github.com/hericklr/improveProtheusTOTVS */
(()=>{"use strict";const e=(e="")=>document.getElementById("mybcontainer_iframe").contentDocument.getElementById("principal").contentDocument.querySelector(e.trim()),t=(e="")=>document.getElementById("mybcontainer_iframe").contentDocument.getElementById("principal").contentDocument.querySelectorAll(e.trim()),r=(e="")=>""===e?"1970-01-01":(e.indexOf("/")>-1&&(2===(e=e.split("/").reverse())[0].length&&(e[0]=`20${e[0]}`),e=e.join("-")),e),a=(e="")=>""===e||4!==(e=e.replace(/\D+/g,"")).length?"00:00:00":e.replace(/(\d{2})(\d{2})$/,"$1:$2:00"),n=e=>new Date(`1970-01-01T${e}+0000`),o=e=>{let t=Math.floor(e/1e3),r=Math.floor(t/60),a=Math.floor(r/60);return r%=60,a=a.toString().padStart(2,"0"),r=r.toString().padStart(2,"0"),`${a}:${r}`},i=e=>parseInt(e.toISOString().substring(11,16).replace(":",""),10),s=()=>{const e=(e="",t="")=>{if(""===(e=e.trim()))return{error:!0,message:"Campo em análise não fornecido"};if(""===(t=t.replace(/[^\d\:]+/g,"")).trim())return{error:!0,message:`É necessário fornecer o limite de horas para os ${e}`};switch(t.length>5&&(t=t.substring(0,4)),(t=t.split(":")).length){case 1:t.push("0");break;case 2:break;default:return{error:!0,message:`Limite de horas para ${e} fornecido está em formato incorreto`}}return NaN===(t=t.map((e=>parseInt(e,10))))[0]||t[0]>11?{error:!0,message:`Horas fornecidas para o limite de horas para os ${e} precisa ser de 0 a 11`}:NaN===t[1]||t[1]>59?{error:!0,message:`Minutos fornecidos para o limite de horas para os ${e} precisa ser de 0 a 59`}:{error:!1,date:`1970-01-01T${t=t.map((e=>e.toString().padStart(2,"0"))).join(":")}:00+0000`}};let t,r,a;t=prompt("Limite de horas para dias de semana (HH:MM)\nMáximo de 11:59",p.weekday.toISOString().substring(11,16)),null!==t&&(r=prompt("Limite de horas para sábados (HH:MM)\nMáximo de 11:59",p.saturday.toISOString().substring(11,16)),null!==r&&(a=e("dias de semana",t),a.error?alert(a.message):(t=a.date,a=e("sábados",r),a.error?alert(a.message):(r=a.date,p={weekday:new Date(t),saturday:new Date(r)},d()))))},d=()=>{const e=u+2,r=i(p.weekday),a=i(p.saturday);let n,o;for(let i of t(`table > tbody > tr > td:nth-of-type(${e})`))i.parentElement.rowIndex<2||(o=parseInt(i.getAttribute("data-time"),10),n=["info-cent"],o>0&&("5"!==i.getAttribute("data-dow")&&o<r||"5"===i.getAttribute("data-dow")&&o<a)&&n.push("out-of-bounds"),i.setAttribute("class",n.join(" ")))},l=e("table > tbody > tr:nth-of-type(1) > th:nth-of-type(1)"),c=parseInt(l.getAttribute("colspan"),10),m=(c-5)/2,u=c-4;let p={weekday:new Date("1970-01-01T05:30:00+0000"),saturday:new Date("1970-01-01T03:00:00+0000")};e("body").hasAttribute("improved")||(e("head").appendChild(document.createElement("style")).innerHTML="table tbody tr:hover{background:#ebebeb}table tbody tr:nth-child(2n+1):hover{background:#e5e5e5}.out-of-bounds{color:#f00}",e("#filterMarks").insertAdjacentHTML("beforeend",'<input name="btnAjustaLimites" id="btnAjustaLimites" type="button" value="Ajusta Limites">'),e("#btnAjustaLimites").addEventListener("click",s),l.setAttribute("colspan",c+1),(()=>{let e,s,d;for(let l of t("table > tbody > tr"))switch(l.rowIndex){case 0:continue;case 1:l.children[u].insertAdjacentHTML("afterend",'<th width="30">Total</th>');continue;default:e=new Date(r(l.children[0].textContent)+"T00:00:00+0000").getDay(),s=0;for(let e=0;e<m;++e)""!==l.children[2*e+2].textContent.trim()&&(s+=n(a(l.children[2*e+3].textContent))-n(a(l.children[2*e+2].textContent)));d=new Date(s),l.children[u].insertAdjacentHTML("afterend",['<td class="info-cent" data-time="',0===s?"0":i(d),'" data-dow="'+e+'">',0===s?"&nbsp;":o(s),"</td>"].join(""))}})(),d(),e("body").setAttribute("improved","yep"))})();